translation("en", {
"job.fueldriver"                                        : "fuel truck driver"
"job.fueldriver.letsgo"                                 : "[FUEL] Let's go to Trago Oil headquartered in Oyster Bay."
"job.fueldriver.needlevel"                              : "[FUEL] You need level %d to become fuel truck driver."
"job.fueldriver.already"                                : "[FUEL] You're fuel truck driver already."
"job.fueldriver.now"                                    : "[FUEL] You're a fuel truck driver now! Congratulations!"
"job.fueldriver.sitintotruck"                           : "[FUEL] Sit into fuel truck."
"job.fueldriver.not"                                    : "[FUEL] You're not a fuel truck driver."
"job.fueldriver.needfueltruck"                          : "[FUEL] You need a fuel truck."
"job.fueldriver.truck.loaded"                           : "[FUEL] Truck is loaded to %d / 16000. Deliver fuel to gas stations."
"job.fueldriver.truck.empty"                            : "[FUEL] The truck is empty. Go to the warehouse of fuel in South Millville to load fuel truck (red cross icon on radar)."
"job.fueldriver.truck.toload"                           : "[FUEL] Go to the warehouse of fuel in South Millville to load fuel truck (red cross icon on radar)."
"job.fueldriver.driving"                                : "[FUEL] You're driving. Please stop the fuel truck."
"job.fueldriver.truck.alreadyloaded"                    : "[FUEL] Fuel truck already loaded."
"job.fueldriver.truck.fullloaded"                       : "[FUEL] Fuel truck is loaded to 16000 / 16000. Deliver fuel to gas stations."
"job.fueldriver.truck.fuelnotenough"                    : "[FUEL] Fuel is not enough. Go to the warehouse to load fuel truck (red cross icon on radar)."
"job.fueldriver.truck.tounload"                         : "[FUEL] Go to gas station to unload fuel."
"job.fueldriver.alreadybeenhere"                        : "[FUEL] You've already been here. Go to other gas station."
"job.fueldriver.truck.parking"                          : "[FUEL] Nice job! Return the fuel truck to Trago Oil headquartered in Oyster Bay, park truck and take your money."
"job.fueldriver.truck.unloadingcompletedtruckisloaded"  : "[FUEL] Unloading completed. Fuel truck is loaded to %d / 16000. Go to next gas station."
"job.fueldriver.truck.unloadingcompletedfuelnotenough"  : "[FUEL] Unloading completed. Fuel is not enough. Go to the warehouse to load fuel truck (red cross icon on radar)."
"job.fueldriver.truck.topark"                           : "[FUEL] Go to Trago Oil headquartered to park the fuel truck."
"job.fueldriver.completedelivery"                       : "[FUEL] Complete fuel delivery to all gas stations."
"job.fueldriver.nicejob"                                : "[FUEL] Nice job! You earned $%.2f."
"job.fueldriver.routelist.title"                        : "[FUEL] ========== List of route =========="
"job.fueldriver.routelist.completed"                    : "[FUEL] %d. Gas station in %s - completed"
"job.fueldriver.routelist.waiting"                      : "[FUEL] %d. Gas station in %s - waiting"
"job.fueldriver.truck.loadedto"                         : "[FUEL] Fuel truck is loaded to %d / 16000"

"job.fueldriver.help.title"                             : "List of available commands for FUELDRIVER JOB:"
"job.fueldriver.help.job"                               : "Get fueldriver job"
"job.fueldriver.help.leavejob"                          : "Leave fueldriver job"
"job.fueldriver.help.ready"                             : "Ready to delivery"
"job.fueldriver.help.load"                              : "Load fuel into truck"
"job.fueldriver.help.unload"                            : "Unload fuel to fuel station"
"job.fueldriver.help.park"                              : "Park the truck to Trago Oil parking"
"job.fueldriver.help.check"                             : "Checking loading truck"
"job.fueldriver.help.list"                              : "See list of route"

});

translation("ru", {
"job.fueldriver"                                        : "водитель бензовоза"
"job.fueldriver.letsgo"                                 : "[FUEL] Отправляйтесь к штаб-квартире Trago Oil в Oyster Bay."
"job.fueldriver.needlevel"                              : "[FUEL] Водителем бензовоза можно устроиться начиная с уровня %d."
"job.fueldriver.already"                                : "[FUEL] Вы уже работает водителем бензовоза."
"job.fueldriver.now"                                    : "[FUEL] Вы стали водителем бензовоза!"
"job.fueldriver.sitintotruck"                           : "[FUEL] Садитесь в бензовоз."
"job.fueldriver.not"                                    : "[FUEL] Вы не работаете водителем бензовоза."
"job.fueldriver.needfueltruck"                          : "[FUEL] Вам нужен бензовоз."
"job.fueldriver.truck.loaded"                           : "[FUEL] Бензовоз заполнен на %d из 16000. Развезите топливо по заправкам."
"job.fueldriver.truck.empty"                            : "[FUEL] Бензовоз пуст. Отправляйтесь к топливному хранилищу в South Millville для загрузки (метка с красным крестом на радаре)."
"job.fueldriver.truck.toload"                           : "[FUEL] Отправляйтесь к топливному хранилищу в South Millville для загрузки (метка с красным крестом на радаре)."
"job.fueldriver.driving"                                : "[FUEL] Остановите бензовоз."
"job.fueldriver.truck.alreadyloaded"                    : "[FUEL] Бензовоз уже заполнен."
"job.fueldriver.truck.fullloaded"                       : "[FUEL] Бензовоз заполнен на 16000 из 16000. Развезите топливо по заправкам."
"job.fueldriver.truck.fuelnotenough"                    : "[FUEL] Недостаточно топлива. Отправляйтесь к топливному хранилищу для загрузки (метка с красным крестом на радаре)"
"job.fueldriver.truck.tounload"                         : "[FUEL] Разгрузка топлива возможна только на заправках."
"job.fueldriver.alreadybeenhere"                        : "[FUEL] Вы уже были здесь. Направляйтесь к другой заправке."
"job.fueldriver.truck.parking"                          : "[FUEL] Хорошая работа! Верните бензовоз к штаб-квартире Trago Oil в Oyster Bay, припаркуйте и получите Ваш заработок."
"job.fueldriver.truck.unloadingcompletedtruckisloaded"  : "[FUEL] Разгрузка выполнена. Бензовоз заполнен на %d из 16000. Направляйтесь к следующей заправке."
"job.fueldriver.truck.unloadingcompletedfuelnotenough"  : "[FUEL] Разгрузка выполнена. Топливо закончилось. Отправляйтесь к топливному хранилищу для загрузки (метка с красным крестом на радаре)"
"job.fueldriver.truck.topark"                           : "[FUEL] Чтобы припарковать бензовоз, отправляйтесь к штаб-квартире Trago Oil в Oyster Bay."
"job.fueldriver.completedelivery"                       : "[FUEL] Развезите топливо по всем заправкам."
"job.fueldriver.nicejob"                                : "[FUEL] Отличная работа! Вы заработали $%.2f."
"job.fueldriver.routelist.title"                        : "[FUEL] ========== Маршутный лист =========="
"job.fueldriver.routelist.completed"                    : "[FUEL] %d. Заправка в %s - доставлено"
"job.fueldriver.routelist.waiting"                      : "[FUEL] %d. Заправка в %s - ожидается"
"job.fueldriver.truck.loadedto"                         : "[FUEL] Бензовоз заполнен на %d из 16000."

"job.fueldriver.help.title"                             : "Список команд, доступных водителю бензовоза:"
"job.fueldriver.help.job"                               : "Устроиться на работу водителем бензовоза"
"job.fueldriver.help.leavejob"                          : "Уволиться с работы"
"job.fueldriver.help.ready"                             : "Выйти в рейс"
"job.fueldriver.help.load"                              : "Загрузить бензовоз"
"job.fueldriver.help.unload"                            : "Выгрузить топливо на заправке"
"job.fueldriver.help.park"                              : "Припарковать бензовоз на парковке Trago Oil"
"job.fueldriver.help.check"                             : "Проверить загруженность бензовоза"
"job.fueldriver.help.list"                              : "Посмотреть маршрутный лист"

});

include("modules/jobs/fueldriver/commands.nut");

local job_fuel = {};
local fuelcars = {};

const FUEL_JOB_RADIUS = 2.0;
const FUEL_JOB_X = 551.762;
const FUEL_JOB_Y = -266.866;
const FUEL_JOB_Z = -20.1644;
const FUEL_JOB_SKIN = 144;
const FUEL_JOB_DISTANCE = 75;
const FUEL_JOB_SALARY = 30.0;
const FUEL_JOB_WAREHOUSE_X = 788.288;
const FUEL_JOB_WAREHOUSE_Y = -78.0801;
const FUEL_JOB_WAREHOUSE_Z = -20.0379;
const FUEL_JOB_LEVEL = 3;
      FUEL_JOB_COLOR <- CL_CRUSTA;

local fuelname = [
    "Oyster Bay",                       // FuelStation Oyster Bay
    "West Side",                        // FuelStation
    "Little Italy",                     // FuelStation LittleItaly Diamond
    "Little Italy (East)",              // FuelStation LittleItaly East
    "East Side",                        // FuelStation EastSide
    "Sand Island",                      // FuelStation Sand Island
    "Greenfield",                       // FuelStation Greenfield
    "Dipton"                            // FuelStation Dipton
];

// 788.288, -78.0801, -20.132   // coords of place to load fuel truck
// 551.762, -266.866, -20.1644  // coords of place to get job fueldriver

local fuelcoords = [
    [549.207, -0.0450191, -18.2822],    // FuelStation Oyster Bay
    [-632.54, -49.2751, 0.877252],      // FuelStation WestSide
    [-148.01, 610.752, -20.1982],       // FuelStation LittleItaly Diamond
    [336.611, 874.779, -21.3369],       // FuelStation LittleItaly East
    [112.749, 179.167, -20.0528],       // FuelStation EastSide
    [-1679.77, -234.395, -20.3644],     // FuelStation Sand Island
    [-1592.45, 944.839, -5.21593],      // FuelStation Greenfield
    [-708.044, 1762.78, -15.0323]       // FuelStation Dipton
];


event("onServerStarted", function() {
    log("[jobs] loading fueldriver job...");
    // DEPRECATED | fuelcars[i][0] - Truck ready: true/false DEPRECATED
    // fuelcars[i][1] - Fuel load: integer
    fuelcars[createVehicle(5, 511.887, -277.5, -20.19, -179.464, -0.05, 0.1)]  <- [false, 0 ];
    fuelcars[createVehicle(5, 517.782, -277.5, -20.19, -177.742, -0.05, 0.1)]  <- [false, 0 ];
    fuelcars[createVehicle(5, 523.821, -277.5, -20.19, -176.393, -0.05, 0.1)]  <- [false, 0 ];

    //creating 3dtext for Trago Oil
    create3DText ( FUEL_JOB_X, FUEL_JOB_Y, FUEL_JOB_Z+0.35, "TRAGO OIL", CL_ROYALBLUE );
    create3DText ( FUEL_JOB_X, FUEL_JOB_Y, FUEL_JOB_Z+0.20, "/help job fuel", CL_WHITE.applyAlpha(75), 3 );

    registerPersonalJobBlip("fueldriver", FUEL_JOB_X, FUEL_JOB_Y);
});

event("onPlayerConnect", function(playerid, name, ip, serial) {
     job_fuel[playerid] <- {};
     job_fuel[playerid]["fuelstatus"] <- [false, false, false, false, false, false, false, false]; // see sequence of gas stations in variable fuelname
     job_fuel[playerid]["fuelBlipText"] <- [ [], [] ];
     job_fuel[playerid]["fuelBlipTextWarehouse"] <- [];
     job_fuel[playerid]["fuelcomplete"] <- 0;  // number of completed fuel stations. Default is 0
});


local fuelJobStationMarks = {};
function createFuelJobStationMarks(playerid, data) {
    if (!(playerid in fuelJobStationMarks)) {
        fuelJobStationMarks[playerid] <- {};
    }

    // ignore creation if they already set
    if (fuelJobStationMarks[playerid].len()) {
        return;
    }

    foreach (id, value in data) {
        fuelJobStationMarks[playerid][id] <- {
            text1 = createPrivate3DText(playerid, value[0], value[1], value[2]-0.15, "/fuel unload", CL_WHITE.applyAlpha(150), 10 ),
            text2 = null, // maybe add later
            blip  = createPrivateBlip(playerid, value[0], value[1], ICON_YELLOW, 4000.0 )
        };
    }
}

function removeFuelJobStationMark(playerid, id) {
    if (playerid in fuelJobStationMarks) {
        if (id in fuelJobStationMarks[playerid]) {
            remove3DText(fuelJobStationMarks[playerid][id].text1);
            // remove3DText(fuelJobStationMarks[playerid][id].text2); // curenlty disabled
            removeBlip(fuelJobStationMarks[playerid][id].blip);

            delete fuelJobStationMarks[playerid][id];
        }
    }
}

function clearFuelJobStationMarks(playerid) {
    if (playerid in fuelJobStationMarks) {
        foreach (id, value in fuelJobStationMarks[playerid]) {
            remove3DText(fuelJobStationMarks[playerid][id].text1);
            // remove3DText(fuelJobStationMarks[playerid][id].text2); // curenlty disabled
            removeBlip(fuelJobStationMarks[playerid][id].blip);
        }
        delete fuelJobStationMarks[playerid];
    }
}


/**
 * Check is player is a fuel driver
 * @param  {int}  playerid
 * @return {Boolean} true/false
 */
function isFuelDriver(playerid) {
    return (isPlayerHaveValidJob(playerid, "fueldriver"));
}

/**
 * Check is player's vehicle is a fuel truck
 * @param  {int}  playerid
 * @return {Boolean} true/false
 */
function isPlayerVehicleFuel(playerid) {
    return (isPlayerInValidVehicle(playerid, 5));
}


/**
 * Check is FuelReady
 * @param  {int}  playerid
 * @return {Boolean} true/false
 */
function isFuelReady(playerid) {
    return fuelcars[vehicleid][0];
}


// working good, check
function fuelJob ( playerid ) {

    if(!isPlayerInValidPoint(playerid, FUEL_JOB_X, FUEL_JOB_Y, FUEL_JOB_RADIUS)) {
        return msg( playerid, "job.fueldriver.letsgo", FUEL_JOB_COLOR );
    }

    if(isFuelDriver(playerid)) {
        return msg( playerid, "job.fueldriver.already", FUEL_JOB_COLOR );
    }

    if(isPlayerHaveJob(playerid)) {
        return msg(playerid, "job.alreadyhavejob", getLocalizedPlayerJob(playerid), FUEL_JOB_COLOR );
    }

    if(!isPlayerLevelValid ( playerid, FUEL_JOB_LEVEL )) {
        return msg(playerid, "job.fueldriver.needlevel", FUEL_JOB_LEVEL, FUEL_JOB_COLOR );
    }

    screenFadeinFadeoutEx(playerid, 250, 200, function() {
        msg( playerid, "job.fueldriver.now", FUEL_JOB_COLOR );
        msg( playerid, "job.fueldriver.sitintotruck", FUEL_JOB_COLOR );

        setPlayerJob( playerid, "fueldriver");

        players[playerid]["skin"] = FUEL_JOB_SKIN;
        setPlayerModel( playerid, FUEL_JOB_SKIN );

        // create private blip job
        //createPersonalJobBlip(playerid, FUEL_JOB_X, FUEL_JOB_Y);
    });
}


// working good, check
function fuelJobLeave ( playerid ) {

    if(!isPlayerInValidPoint(playerid, FUEL_JOB_X, FUEL_JOB_Y, FUEL_JOB_RADIUS)) {
        return msg( playerid, "job.fueldriver.letsgo", FUEL_JOB_COLOR );
    }

    if(!isFuelDriver(playerid)) {
        return msg( playerid, "job.fueldriver.not", FUEL_JOB_COLOR );
    }
    screenFadeinFadeoutEx(playerid, 250, 200, function() {
        msg( playerid, "job.leave", FUEL_JOB_COLOR );

        setPlayerJob( playerid, null );

        players[playerid]["skin"] = players[playerid]["default_skin"];
        setPlayerModel( playerid, players[playerid]["default_skin"]);

        // remove private blip job
        removePersonalJobBlip ( playerid );

        // clear all marks
        clearFuelJobStationMarks(playerid);
        fuelJobWarehouseRemoveBlipText( playerid );
    });
}


// working good, check
function fuelJobReady ( playerid ) {

    if(!isFuelDriver(playerid)) {
        return msg( playerid, "job.fueldriver.not", FUEL_JOB_COLOR );
    }

    if (!isPlayerVehicleFuel(playerid)) {
        return msg(playerid, "job.fueldriver.needfueltruck", FUEL_JOB_COLOR );
    }

    local vehicleid = getPlayerVehicle(playerid);

    // create blip and 3text for warehouse
    fuelJobWarehouseCreateBlipText( playerid );

    if(fuelcars[vehicleid][1] >= 4000) {
        msg( playerid, "job.fueldriver.truck.loaded", fuelcars[vehicleid][1], FUEL_JOB_COLOR );
    } else {
        msg( playerid, "job.fueldriver.truck.empty", FUEL_JOB_COLOR );
    }
}

// working good, check
function fuelJobLoad ( playerid ) {

    if(!isFuelDriver(playerid)) {
        return msg( playerid, "job.fueldriver.not", FUEL_JOB_COLOR );
    }

    if (!isPlayerVehicleFuel(playerid)) {
        return msg(playerid, "job.fueldriver.needfueltruck", FUEL_JOB_COLOR );
    }

    local vehicleid = getPlayerVehicle(playerid);

    if(!isPlayerVehicleInValidPoint(playerid, FUEL_JOB_WAREHOUSE_X, FUEL_JOB_WAREHOUSE_Y, 5.0)) {
        // create blip and 3text for warehouse
        fuelJobWarehouseCreateBlipText( playerid );
        return msg( playerid, "job.fueldriver.truck.toload", FUEL_JOB_COLOR );
    }

    if(isPlayerVehicleMoving(playerid)){
        return msg( playerid, "job.fueldriver.driving", CL_RED );
    }

    if(fuelcars[vehicleid][1] == 16000) {
       return msg( playerid, "job.fueldriver.truck.alreadyloaded", FUEL_JOB_COLOR );
    }

    if(fuelcars[vehicleid][1] < 16000) {
        fuelcars[vehicleid][1] = 16000;
        msg( playerid, "job.fueldriver.truck.fullloaded", FUEL_JOB_COLOR );
    }

    // create fuel marks
    createFuelJobStationMarks(playerid, fuelcoords);
    // remove Warehouse blip
    //fuelJobWarehouseRemoveBlipText( playerid );
}

// working good, check
function fuelJobUnload ( playerid ) {

    if(!isFuelDriver(playerid)) {
        return msg( playerid, "job.fueldriver.not", FUEL_JOB_COLOR );
    }

    if (!isPlayerVehicleFuel(playerid)) {
        return msg(playerid, "job.fueldriver.needfueltruck", FUEL_JOB_COLOR );
    }

    local vehicleid = getPlayerVehicle(playerid);

    if(fuelcars[vehicleid][1] < 4000) {
        return msg( playerid, "job.fueldriver.truck.fuelnotenough", FUEL_JOB_COLOR );
    }

    local check = false;
    local i = -1;
    foreach (key, value in fuelcoords) {
        if (isPlayerVehicleInValidPoint(playerid, value[0], value[1], 5.0 )) {
            check = true;
            i = key;
            break;
        }
    }

    if (!check) {
       return  msg( playerid, "job.fueldriver.truck.tounload", FUEL_JOB_COLOR );
    }

    if(isPlayerVehicleMoving(playerid)){
        return msg( playerid, "job.fueldriver.driving", CL_RED );
    }

    if(job_fuel[playerid]["fuelstatus"][i]) {
        return msg( playerid, "job.fueldriver.alreadybeenhere", FUEL_JOB_COLOR );
    }

    fuelcars[vehicleid][1] -= 4000;
    job_fuel[playerid]["fuelstatus"][i] = true;
    job_fuel[playerid]["fuelcomplete"] += 1;

    // remove blip on complete unload
    removeFuelJobStationMark(playerid, i);

    if (job_fuel[playerid]["fuelcomplete"] == 8) {
        msg( playerid, "job.fueldriver.truck.parking", FUEL_JOB_COLOR );
        fuelJobWarehouseRemoveBlipText( playerid );
    } else {
        if (fuelcars[vehicleid][1] >= 4000) {
            msg( playerid, "job.fueldriver.truck.unloadingcompletedtruckisloaded", fuelcars[vehicleid][1], FUEL_JOB_COLOR );
        } else {
            msg( playerid, "job.fueldriver.truck.unloadingcompletedfuelnotenough", FUEL_JOB_COLOR );
        }
    }
}


// working good, check
function fuelJobPark ( playerid ) {

    if(!isFuelDriver(playerid)) {
        return msg( playerid, "job.fueldriver.not", FUEL_JOB_COLOR );
    }

    if (!isPlayerVehicleFuel(playerid)) {
        return msg(playerid, "job.fueldriver.needfueltruck", FUEL_JOB_COLOR );
    }

    local vehicleid = getPlayerVehicle(playerid);

    if(!isPlayerVehicleInValidPoint(playerid, 517.782, -277.5, 10.0)) {
        return msg( playerid, "job.fueldriver.truck.topark", FUEL_JOB_COLOR );
    }

    if(isPlayerVehicleMoving(playerid)){
        return msg( playerid, "job.fueldriver.driving", CL_RED );
    }

    if (job_fuel[playerid]["fuelcomplete"] < 8) {
        return msg( playerid, "job.fueldriver.completedelivery", FUEL_JOB_COLOR );
    }

    job_fuel[playerid]["fuelcomplete"] = 0;
    msg( playerid, "job.fueldriver.nicejob", FUEL_JOB_SALARY, FUEL_JOB_COLOR );
    addMoneyToPlayer(playerid, FUEL_JOB_SALARY);

    // clear all marks
    clearFuelJobStationMarks( playerid );
}


// working good, check
function fuelJobList ( playerid ) {
    if(players[playerid]["job"] == "fueldriver")    {
        msg( playerid, "job.fueldriver.routelist.title", CL_JOB_LIST);
        foreach (key, value in job_fuel[playerid]["fuelstatus"]) {
            local i = key+1;
            if (value == true) {
                msg( playerid, "job.fueldriver.routelist.completed", [i , fuelname[key]], CL_JOB_LIST_GR);
            } else {
                msg( playerid, "job.fueldriver.routelist.waiting", [i, fuelname[key]], CL_JOB_LIST_R);
            }
        }
    } else { msg( playerid, "job.fueldriver.not", FUEL_JOB_COLOR ); }
}

// working good, check
function fuelJobCheck ( playerid ) {

    if(!isFuelDriver(playerid)) {
        return msg( playerid, "job.fueldriver.not", FUEL_JOB_COLOR );
    }

    if (!isPlayerVehicleFuel(playerid)) {
        return msg(playerid, "job.fueldriver.needfueltruck", FUEL_JOB_COLOR );
    }

    local vehicleid = getPlayerVehicle(playerid);
    msg( playerid, "job.fueldriver.truck.loadedto", fuelcars[vehicleid][1], FUEL_JOB_COLOR  );
}


function fuelJobWarehouseCreateBlipText( playerid ) {
    if(job_fuel[playerid]["fuelBlipTextWarehouse"].len() < 1) {
        job_fuel[playerid]["fuelBlipTextWarehouse"].push( createPrivate3DText (playerid, FUEL_JOB_WAREHOUSE_X, FUEL_JOB_WAREHOUSE_Y, FUEL_JOB_WAREHOUSE_Z+0.35, "=== FUEL WAREHOUSE ===", CL_RIPELEMON, 100.0 ));
        job_fuel[playerid]["fuelBlipTextWarehouse"].push( createPrivate3DText (playerid, FUEL_JOB_WAREHOUSE_X, FUEL_JOB_WAREHOUSE_Y, FUEL_JOB_WAREHOUSE_Z-0.15, "/fuel load", CL_WHITE.applyAlpha(150), 5.0 ));
        job_fuel[playerid]["fuelBlipTextWarehouse"].push( createPrivateBlip(playerid, FUEL_JOB_WAREHOUSE_X, FUEL_JOB_WAREHOUSE_Y, ICON_CROSS, 4000.0));
    }
}

function fuelJobWarehouseRemoveBlipText( playerid ) {
    if(job_fuel[playerid]["fuelBlipTextWarehouse"].len() > 0) {
        remove3DText(job_fuel[playerid]["fuelBlipTextWarehouse"][0]);
        remove3DText(job_fuel[playerid]["fuelBlipTextWarehouse"][1]);
        removeBlip(job_fuel[playerid]["fuelBlipTextWarehouse"][2]);
        job_fuel[playerid]["fuelBlipTextWarehouse"].clear();
    }
}
